<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>T.V. Vierhoeven – QR Kiosk (1-pagina)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#F4E64C">
  <style>
    :root{
      --tvv-yellow:#F4E64C;
      --panel:#fff;
      --text:#0b0b0b;
      --shadow:0 8px 30px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0; background:var(--tvv-yellow);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
      color:var(--text);
      display:flex; flex-direction:column; gap:14px; padding:20px;
      align-items:center;
    }
    header{width:100%;max-width:960px;text-align:center;}
    h1{margin:0;font-size:clamp(20px,4vw,32px);}
    .frame-wrap{
      width:100%; max-width:960px; flex:1;
      display:flex; align-items:center; justify-content:center;
      min-height:60vh; border-radius:20px; overflow:hidden;
      background:var(--panel); box-shadow:var(--shadow);
      border:2px solid rgba(0,0,0,.06);
    }
    iframe{width:100%; height:100%; border:0; background:#fff;}
    .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; margin-top:4px;}
    .btn{appearance:none; border:0; border-radius:12px; padding:10px 14px; background:#111; color:#fff; font-weight:700; cursor:pointer; box-shadow:var(--shadow);}
    .hint{font-size:13px; opacity:.85}
    footer{font-size:12px; color:#333; opacity:.8}
    .safe{padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);}
  </style>
</head>
<body class="safe">
  <header aria-hidden="true">
    <h1>QR Check-in</h1>
    <div class="controls">
      <button id="fsBtn" class="btn" title="Volledig scherm">Fullscreen</button>
      <span class="hint">Verversing elke 5 minuten • Scherm blijft aan (indien ondersteund)</span>
    </div>
  </header>

  <div class="frame-wrap">
    <iframe id="qrframe" title="QR Check-in"></iframe>
  </div>

  <footer>© T.V. Vierhoeven — Kiosk modus</footer>

<script>
  const QR_URL = "https://pr01.allunited.nl/x/location_checkin_qrcode.php?id=UUpXbytRSUN5NzBMTDZ0NUIxTWt2enZ2TUlFa0FheHh5VHRVeXgyQXdnOUMydDU0NGo5bGpwR3JESmNqTm9INTc4V21hQ2tZVUhacTNHT0hXcWMxeFdHb0F5TXBLV0NTZm9vcHlRdXJoWUJ6M0tEL1k1amhOVVhDN3BKN2l5MlVzRUI2LzVsMllLNlhHcUFJTERObCtTOVI4bDhHdEQwMHZzd3pSWkxDWlhHeFg4ZEN6ODB5SVhmSUFXWFNCVzVIYWV2YzY4c3NSZ2dyWVhhU2NUTEc3QkRXWkZQdi9uY2I1SElTQWZPMEJRQT0=";

  const frame = document.getElementById("qrframe");

  function iframeHtml(src){
    return `<!doctype html><html lang="nl"><head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
      <style>
        html,body{height:100%;margin:0;background:#fff;}
        .wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:2vmin;}
        img{width:100%;height:100%;object-fit:contain;image-rendering:pixelated;}
      </style>
    </head><body>
      <div class="wrap">
        <img id="qri" alt="QR" src="${src}">
      </div>
      <script>
        const FIVE_MIN = 5*60*1000;
        const BASE = ${JSON.stringify(QR_URL)};
        function bust(){ document.getElementById('qri').src = BASE + (BASE.includes('?') ? '&' : '?') + 't=' + Date.now(); }
        setInterval(bust, FIVE_MIN);
      <\/script>
    </body></html>`;
  }

  function cacheBusted(){ return QR_URL + (QR_URL.includes('?') ? '&' : '?') + "t=" + Date.now(); }
  function render(){ frame.srcdoc = iframeHtml(cacheBusted()); }

  render();
  setInterval(render, 5*60*1000);

  document.getElementById('fsBtn').addEventListener('click', () => {
    const el = document.documentElement;
    const req = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
    if (req) req.call(el);
  });

  let wakeLock = null;
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
      }
    } catch (err) {}
  }
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible' && wakeLock === null) requestWakeLock();
  });
  requestWakeLock();
</script>
</body>
</html>
